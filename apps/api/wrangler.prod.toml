# ===========================================
# Production Wrangler Configuration
# ===========================================
# Use with: wrangler deploy --config wrangler.prod.toml
# Or: pnpm deploy:api:prod

name = "saas-api"
main = "src/index.ts"
compatibility_date = "2024-05-01"
compatibility_flags = ["nodejs_compat"]

# ===========================================
# Environment Variables
# ===========================================
[vars]
ENVIRONMENT = "production"
# Public URLs - update these for your domain
PUBLIC_APP_URL = "https://your-app.pages.dev"
PUBLIC_API_URL = "https://saas-api.your-account.workers.dev"
# Rate limiting
RATE_LIMIT_DEFAULT = "100"
RATE_LIMIT_AUTH = "10"
# File upload limits
MAX_FILE_SIZE = "10485760"
ALLOWED_FILE_TYPES = "image/jpeg,image/png,image/gif,application/pdf"

# ===========================================
# D1 Database Binding - Production
# ===========================================
# Create with: wrangler d1 create saas-db-prod
# Then update database_id below
[[d1_databases]]
binding = "DB"
database_name = "saas-db-prod"
database_id = "YOUR_PROD_D1_DATABASE_ID"

# ===========================================
# R2 Storage Binding - Production
# ===========================================
# Create with: wrangler r2 bucket create saas-storage-prod
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "saas-storage-prod"

# ===========================================
# KV Namespace - Production
# ===========================================
# Create with: wrangler kv:namespace create KV
# Then update id below
[[kv_namespaces]]
binding = "KV"
id = "YOUR_PROD_KV_NAMESPACE_ID"

# ===========================================
# Worker Limits & Performance
# ===========================================
[limits]
cpu_ms = 50

# ===========================================
# Observability
# ===========================================
[observability]
enabled = true

# ===========================================
# Secrets (set via wrangler secret put)
# ===========================================
# Required secrets - set these before deployment:
#
# Authentication:
#   wrangler secret put AUTH_SECRET --config wrangler.prod.toml
#
# Telegram Notifications:
#   wrangler secret put TELEGRAM_BOT_TOKEN --config wrangler.prod.toml
#   wrangler secret put TELEGRAM_CHAT_ID --config wrangler.prod.toml
#
# Email Notifications:
#   wrangler secret put EMAIL_API_KEY --config wrangler.prod.toml
#   wrangler secret put EMAIL_FROM --config wrangler.prod.toml
#
# Webhook Verification:
#   wrangler secret put WEBHOOK_SECRET --config wrangler.prod.toml
#
# ===========================================

# ===========================================
# Custom Domains (optional)
# ===========================================
# Uncomment and configure if using custom domain:
# routes = [
#   { pattern = "api.yourdomain.com", custom_domain = true }
# ]
